{% extends "base.html" %}
{% load static %}

{% block content %}
    <div class="tab-content pb-5" id="pills-tabContent">
        <div class="tab-pane fade" id="pills-berita" role="tabpanel" aria-labelledby="pills-berita-tab">
            <div class="container">
                <div class="row row1 d-flex justify-content-center">
                    <div class="col-md-10">
                        {% for o in posts %}
                        <div class="card post-box-news border-primary pb-3" style="max-width: 30rem;">
                            <div class="card-header">Header</div>
                            <div class="card-body text-primary">
                                <h5 class="card-title">{{o.title}}</h5>
                                <p class="card-text">{{o.rl_date}}</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div> 
                </div>
                <div class="row d-flex justify-content-center"><button class="btn btn-dark" type="submit" id="load_news">Load More</button></div>       
            </div>
        </div>

        <div class="tab-pane fade" id="pills-publikasi" role="tabpanel" aria-labelledby="pills-publikasi-tab">
            <div class="container">
                <div class="row row2 d-flex justify-content-center">
                    <div class="col-md-10">
                        {% for o in posts %}
                        <div class="card post-box-pub border-primary pb-3" style="max-width: 30rem;">
                            <div class="card-header">Header</div>
                            <div class="card-body text-primary">
                                <h5 class="card-title">{{o.title}}</h5>
                                <p class="card-text">{{o.cover}}</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div> 
                </div>
                <div class="row d-flex justify-content-center"><button class="btn btn-dark" type="submit" id="load_pub">Load More</button></div>       
            </div>
        </div>	
        	
        <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">Home</div>
        <div class="tab-pane fade" id="pills-data" role="tabpanel" aria-labelledby="pills-data-tab">Data</div>
        <div class="tab-pane fade" id="pills-brs" role="tabpanel" aria-labelledby="pills-brs-tab">
            <div class="container">
                <div class="row row5 d-flex justify-content-center">
                    <div class="col-md-10">
                        {% for o in posts %}
                        <div class="card post-box-brs border-primary pb-3" style="max-width: 30rem;">
                            <div class="card-header">Header</div>
                            <div class="card-body text-primary">
                                <h5 class="card-title">{{o.title}}</h5>
                                <p class="card-text">{{o.rl_date}}</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div> 
                </div>
                <div class="row d-flex justify-content-center"><button class="btn btn-dark" type="submit" id="load_brs">Load More</button></div>       
            </div>
        </div>
    </div>
{% endblock content %}

{% block scripts %}
    {% include "snippets/scripts.html" %}
    {% csrf_token %}
    <script>

    $(document).ready(function(){
        ////BERITA////
        //INIT
        $("#pills-berita-tab").on('click',function(){
            $('#header').text('Berita');
            $(window).scrollTop(0);
            $("#load_news").show();
            $("#load_news").removeClass('disabled').text('Load More');
            $.ajax({
                url:"{% url 'load_init_news' %}",
                type:'post',
                data:{
                    'csrfmiddlewaretoken':"{{csrf_token}}"
                },
                dataType:'json',
                success:function(res){
                    var _html='';
                    var json_data=res.posts;
                    $.each(json_data,function(index,data){
                        _html+='<div class="card post-box-news border-primary b-3" style="width: 30rem;">'+
                            '<div class="card-header">Header</div>'+
                            '<div class="card-body text-primary">'+
                            '<h5 class="card-title">'+data.title+'</h5>'+
                            '<p class="card-text">'+data.rl_date+'</p>'+
                            '</div>'+
                            '</div>'
                            ;
                       });
                    $(".row1").html(_html);
                    
                }
            });
        });
        //ADD MORE
        $("#load_news").on('click',function(){
            var _currentResult=$(".post-box-news").length;
            $.ajax({
                url:"{% url 'load_more_news' %}",
                type:'post',
                data:{
                    'offset':_currentResult,
                    'csrfmiddlewaretoken':"{{csrf_token}}"
                },
                dataType:'json',
                beforeSend:function(){
                    $("#load_news").addClass('disabled').text('Loading..');
                },
                success:function(res){
                    var _html='';
                    var json_data=res.posts;
                    $.each(json_data,function(index,data){
                        _html+='<div class="card post-box-news border-primary b-3" style="width: 30rem;">'+
                            '<div class="card-header">Header</div>'+
                            '<div class="card-body text-primary">'+
                            '<h5 class="card-title">'+data.title+'</h5>'+
                            '<p class="card-text">'+data.rl_date+'</p>'+
                            '</div>'+
                            '</div>'
                            ;
                       });
                    $(".row1").append(_html);
                    var _countTotal=$(".post-box-news").length;
                    console.log(_countTotal,+'--'+res.totalResult);
                    
                    if(_countTotal==res.totalResult){
                        $("#load_news").hide();
                    }else{
                        $("#load_news").removeClass('disabled').text('Load More');
                    }
                }
            });
        });

        ////PUBLIKASI////
        //INIT
        $("#pills-publikasi-tab").on('click',function(){
            $('#header').text('Publikasi');
            $(window).scrollTop(0);
            $("#load_pub").show();
            $("#load_pub").removeClass('disabled').text('Load More');
            $.ajax({
                url:"{% url 'load_init_pub' %}",
                type:'post',
                data:{
                    'csrfmiddlewaretoken':"{{csrf_token}}"
                },
                dataType:'json',
                success:function(res){
                    var _html='';
                    var json_data=res.posts;
                    $.each(json_data,function(index,data){
                        _html+='<div class="card post-box-pub border-primary b-3" style="width: 30rem;">'+
                            '<div class="card-header">Header</div>'+
                            '<div class="card-body text-primary">'+
                            '<h5 class="card-title">'+data.title+'</h5>'+
                            '<p class="card-text">'+data.rl_date+'</p>'+
                            '</div>'+
                            '</div>'
                            ;
                       });
                    $(".row2").html(_html);
                    
                }
            });
        });
        //ADD MORE
        $("#load_pub").on('click',function(){
            var _currentResult=$(".post-box-pub").length;
            $.ajax({
            	url:"{% url 'load_more_pub' %}",
            	type:'post',
            	data:{
            		'offset':_currentResult,
            		'csrfmiddlewaretoken':"{{csrf_token}}"
            	},
            	dataType:'json',
            	beforeSend:function(){
            		$("#load_pub").addClass('disabled').text('Loading..');
            	},
            	success:function(res){
            		var _html='';
            		var json_data=res.posts;
            		$.each(json_data,function(index,data){
            			_html+='<div class="card post-box-pub border-primary b-3" style="width: 30rem;">'+
                            '<div class="card-header">Header</div>'+
                            '<div class="card-body text-primary">'+
                            '<h5 class="card-title">'+data.title+'</h5>'+
                            '<p class="card-text">'+data.rl_date+'</p>'+
                            '</div>'+
                            '</div>'
                            ;
                       });
            		$(".row2").append(_html);
            		var _countTotal=$(".post-box-pub").length;
            		console.log(_countTotal,+'--'+res.totalResult);
            		
            		if(_countTotal==res.totalResult){
            			$("#load_pub").remove();
            		}else{
            			$("#load_pub").removeClass('disabled').text('Load More');
            		}
            	}
            });
        });

        ////BRS////
        //INIT
        $("#pills-brs-tab").on('click',function(){
            $('#header').text('Berita Resmi Statistik');
            $(window).scrollTop(0);
            $("#load_pub").show();
            $("#load_pub").removeClass('disabled').text('Load More');
            $.ajax({
                url:"{% url 'load_init_brs' %}",
                type:'post',
                data:{
                    'csrfmiddlewaretoken':"{{csrf_token}}"
                },
                dataType:'json',
                success:function(res){
                    var _html='';
                    var json_data=res.posts;
                    $.each(json_data,function(index,data){
                        _html+='<div class="card post-box-brs border-primary b-3" style="width: 30rem;">'+
                            '<div class="card-header">Header</div>'+
                            '<div class="card-body text-primary">'+
                            '<h5 class="card-title">'+data.title+'</h5>'+
                            '<p class="card-text">'+data.rl_date+'</p>'+
                            '</div>'+
                            '</div>'
                            ;
                       });
                    $(".row5").html(_html);
                    
                }
            });
        });
        //ADD MORE
        $("#load_brs").on('click',function(){
            var _currentResult=$(".post-box-brs").length;
            $.ajax({
                url:"{% url 'load_more_brs' %}",
                type:'post',
                data:{
                    'offset':_currentResult,
                    'csrfmiddlewaretoken':"{{csrf_token}}"
                },
                dataType:'json',
                beforeSend:function(){
                    $("#load_brs").addClass('disabled').text('Loading..');
                },
                success:function(res){
                    var _html='';
                    var json_data=res.posts;
                    $.each(json_data,function(index,data){
                        _html+='<div class="card post-box-brs border-primary b-3" style="width: 30rem;">'+
                            '<div class="card-header">Header</div>'+
                            '<div class="card-body text-primary">'+
                            '<h5 class="card-title">'+data.title+'</h5>'+
                            '<p class="card-text">'+data.rl_date+'</p>'+
                            '</div>'+
                            '</div>'
                            ;
                       });
                    $(".row5").append(_html);
                    var _countTotal=$(".post-box-brs").length;
                    console.log(_countTotal,+'--'+res.totalResult);
                    
                    if(_countTotal==res.totalResult){
                        $("#load_brs").remove();
                    }else{
                        $("#load_brs").removeClass('disabled').text('Load More');
                    }
                }
            });
        });
    });
    </script>
{% endblock scripts %}
